<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>泽钛造水</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0,user-scalable=no" viewport-fit="cover"/>
    <link rel="stylesheet" href="css/addressEdit.css">
    <script src="js/index.js"></script>
</head>
<body>

<!-- content -->
<section id="address-edit">
    <div class="inner">
        <form action="">
            <div class="formLine">
                <span class="label">收货人</span>
                <input id="name" type="text" placeholder="" value="">
            </div>
            <div class="formLine">
                <span class="label">电话</span>
                <input id="tell" type="tel" placeholder="" value="">
            </div>
            <div class="formLine">
                <span class="label">所在地区</span>
                <a href="javascript:;" id="area" class="myInput">选择城市</a>
            </div>
            <div class="formLine">
                <span class="label textareaLabel">详细地址</span>
                <textarea name="" id="detailAddress" placeholder="请输入详细地址信息，如门牌号、小区、单元等"></textarea>
            </div>
            <input id="btn-save" type="submit" class="btn btn-save" value="保存">
        </form>
    </div>
</section>
<!-- tab bar -->
<section class="tabBar">
    <a href="index.html" class="home">
        <span class="icon icon-home"></span>
        首页
    </a>
    <a href="order.html" class="yuyue">
        <span class="icon icon-yuyue"></span>
        预约
    </a>
    <a href="me.html" class="me">
        <span class="icon icon-me"></span>
        个人中心
    </a>
    <a href="equipment.html" class="shebei">
        <span class="icon icon-shebei"></span>
        设备管理
    </a>
</section>


<script src="lib/jquery.min.js"></script>
<script src="lib/city.js"></script>
<script src="lib/picker.min.js"></script>
<script>
    $(function () {

        // 三级联动地区选择
        var nameEl = document.getElementById('area');

        var first = [];
        /* 省，直辖市 */
        var second = [];
        /* 市 */
        var third = [];
        /* 镇 */

        var selectedIndex = [0, 0, 0];
        /* 默认选中的地区 */

        var checked = [0, 0, 0];

        /* 已选选项 */

        function creatList(obj, list) {
            obj.forEach(function (item, index, arr) {
                var temp = new Object();
                temp.text = item.name;
                temp.value = index;
                list.push(temp);
            })
        }

        creatList(city, first);

        if (city[selectedIndex[0]].hasOwnProperty('sub')) {
            creatList(city[selectedIndex[0]].sub, second);
        } else {
            second = [{text: '', value: 0}];
        }

        if (city[selectedIndex[0]].sub[selectedIndex[1]].hasOwnProperty('sub')) {
            creatList(city[selectedIndex[0]].sub[selectedIndex[1]].sub, third);
        } else {
            third = [{text: '', value: 0}];
        }

        var picker = new Picker({
            data: [first, second, third],
            selectedIndex: selectedIndex,
            title: ''
        });

        picker.on('picker.select', function (selectedVal, selectedIndex) {
            var text1 = first[selectedIndex[0]].text;
            var text2 = second[selectedIndex[1]].text;
            var text3 = third[selectedIndex[2]] ? third[selectedIndex[2]].text : '';

            nameEl.innerText = text1 + ' ' + text2 + ' ' + text3;
        });

        picker.on('picker.change', function (index, selectedIndex) {
            if (index === 0) {
                firstChange();
            } else if (index === 1) {
                secondChange();
            }

            function firstChange() {
                second = [];
                third = [];
                checked[0] = selectedIndex;
                var firstCity = city[selectedIndex];
                if (firstCity.hasOwnProperty('sub')) {
                    creatList(firstCity.sub, second);

                    var secondCity = city[selectedIndex].sub[0];
                    if (secondCity.hasOwnProperty('sub')) {
                        creatList(secondCity.sub, third);
                    } else {
                        third = [{text: '', value: 0}];
                        checked[2] = 0;
                    }
                } else {
                    second = [{text: '', value: 0}];
                    third = [{text: '', value: 0}];
                    checked[1] = 0;
                    checked[2] = 0;
                }

                picker.refillColumn(1, second);
                picker.refillColumn(2, third);
                picker.scrollColumn(1, 0);
                picker.scrollColumn(2, 0)
            }

            function secondChange() {
                third = [];
                checked[1] = selectedIndex;
                var first_index = checked[0];
                if (city[first_index].sub[selectedIndex].hasOwnProperty('sub')) {
                    var secondCity = city[first_index].sub[selectedIndex];
                    creatList(secondCity.sub, third);
                    picker.refillColumn(2, third);
                    picker.scrollColumn(2, 0)
                } else {
                    third = [{text: '', value: 0}];
                    checked[2] = 0;
                    picker.refillColumn(2, third);
                    picker.scrollColumn(2, 0)
                }
            }

        });

        picker.on('picker.valuechange', function (selectedVal, selectedIndex) {
            console.log(selectedVal);
            console.log(selectedIndex);
        });

        nameEl.addEventListener('click', function () {
            picker.show();
        });

        //  获取输入框中的值
        var name, tell, area, detailAddress;

        // 点击保存
        $('#btn-save').click(function (e) {
            e.preventDefault();
            name = $('#name').val();
            tell = $('#tell').val();
            area = $('#area').val();
            detailAddress = $('#detailAddress').val();
            console.log(name);
            console.log(tell);
            console.log(area);
            console.log(detailAddress);

            $.ajax({
                type: 'POST',
                url: '',
                "dataType": "json",
                "data": {"url": window.location.href},
                "success": function (data) {
                    // to-do
                }
            })

        });
    })
</script>
</body>
</html>